## docker build を速くする方法
今日は不毛な作業をしていたが、表題に関しては新しい知識だった。

docker build があまりにも遅く、開発環境構築時に効率が悪いので速くする方法を調べていた。
たぶんいろいろあるけど、今日分かったことはこれ。

- Dockerfileが存在するディレクトリには、ソースコードなどファイルサイズが大きいもので不要なものは置かないほうがよい。
>dockerはビルド開始時にdocker daemonにDockerfileのディレクトリにあるファイルを全部`tar`して送る

- `RUN` を連続で実行するとその分レイヤーが増えてイメージが大きくなる。 `&&` でまとめてレイヤーを最小限に抑えるというのがイメージ軽量化のテクニック
>1つのレイヤーに全てをまとめることがよいかどうかは考えどころ。レイヤーを分けることにより、並列ダウンロードが可能になったり、cacheが有効活用できたり、可読性が向上する。
>そのため、最終的には計測して決めることが重要。とはいえ、指針としては、複数レイヤーに跨がらない程度に分割するのが良さそうではある。


今回は計測はせず、思考停止でDockerfileの移動と、意味ごとにレイヤーを分けた。
体感的にはbuildに10分かかっていたのが、5分に半減したと思う。

## 参考
[docker buildを速くするコツ](https://scrapbox.io/keroxp/docker_buildを速くするコツ)  
[【docker buildのマニアックすぎる狂宴】Container Build Meetup #1に参加してきた #container_build](https://dev.classmethod.jp/tool/docker/docker-build-meetup-1/)
